<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Modificar contraseña</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <h2>Modificar contraseña</h2>
    <form id="form-pass">
      <input name="oldPass" type="password" placeholder="Actual" required />
      <input
        name="newPass"
        type="password"
        placeholder="Nueva (mín. 6)"
        minlength="6"
        required
      />
      <button>Cambiar</button>
    </form>
    <p><a href="/dashboard.html">← Volver</a></p>
    <pre id="msg"></pre>
    <script>
  const API = 'http://localhost:3000';
  const token = localStorage.getItem('token');

  // Si no hay token, redirige a login
  if (!token) location.href = '/index.html';

  const form = document.getElementById('form-pass');
  const msg  = document.getElementById('msg');

  // Función para mostrar mensajes
  const showMessage = (text, type = 'info') => {
    msg.textContent = text;
    msg.className = ''; // limpiar clases previas
    msg.style.display = 'block';

    if (type === 'success') {
      msg.style.color = '#22a6b3';      // verde/azul para éxito
    } else if (type === 'error') {
      msg.style.color = '#e84118';      // rojo para error
    } else {
      msg.style.color = '#2f3640';      // texto normal
    }
  };

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.style.display = 'none'; // ocultar mensaje previo

    const payload = Object.fromEntries(new FormData(form));

    try {
      const resp = await fetch(`${API}/auth/change-password`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`,
        },
        body: JSON.stringify(payload),
      });

      const body = await resp.json();

      // Depuración en consola
      console.log('STATUS', resp.status, 'BODY', body);

      if (!resp.ok) {
        throw new Error(body.error || `Error ${resp.status}`);
      }

      // ✅ Contraseña cambiada con éxito
      showMessage('Contraseña actualizada correctamente ✅', 'success');
      form.reset();

    } catch (err) {
      showMessage(err.message, 'error');
    }
  });
</script>

  </body>
</html>
